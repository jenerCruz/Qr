name: Detectar Cambios y Hacer Push (con DiÃ¡logo)

on:
  workflow_dispatch:  # Para ejecutar manualmente
  push:               # Opcional: Ejecutar al hacer push a una rama especÃ­fica
    branches: [ main ]

jobs:
  detect-changes-and-push:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout del repositorio
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Clona todo el historial para detectar cambios

      - name: Detectar cambios y hacer commit/push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "ğŸ” **Iniciando revisiÃ³n de cambios en el repositorio...**"

          # Configurar git
          echo "ğŸ›  Configurando git con las credenciales de GitHub Actions..."
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          echo "âœ… Git configurado correctamente."

          # Detectar cambios en el repositorio
          if [ -n "$(git status --porcelain)" ]; then
            echo "ğŸ“‹ **Se detectaron cambios locales en los siguientes archivos:**"
            git status --porcelain
            echo ""

            echo "ğŸ“‚ AÃ±adiendo todos los cambios al Ã¡rea de staging..."
            git add .
            echo "âœ… Todos los cambios fueron aÃ±adidos."

            echo "ğŸ“ Preparando commit con los cambios detectados..."
            git commit -m "ğŸ¤– Auto-commit: ActualizaciÃ³n de archivos [$(date +'%Y-%m-%d %H:%M:%S')]"
            echo "âœ… Commit creado con Ã©xito."

            echo "ğŸ“¤ Subiendo los cambios a la rama '${{ github.ref_name }}'..."
            git push origin HEAD:${{ github.ref_name }}
            echo "âœ… Cambios subidos correctamente a la rama '${{ github.ref_name }}'."

            echo "---
            ğŸ‰ **Proceso completado con Ã©xito.**
            ğŸ“Œ **Resumen:**
            - Se detectaron cambios locales.
            - Se aÃ±adieron los cambios al Ã¡rea de staging.
            - Se creÃ³ un commit automÃ¡tico.
            - Se subieron los cambios al repositorio remoto.
            ---"
          else
            echo "ğŸ” **No se detectaron cambios locales en el repositorio.**
            ğŸ“Œ **Resumen:**
            - No hay archivos modificados, nuevos o eliminados.
            - No se realizÃ³ ningÃºn commit ni push.
            ---"
          fi
